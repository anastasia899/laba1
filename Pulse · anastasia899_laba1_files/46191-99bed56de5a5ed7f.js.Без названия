performance.mark("js-parse-end:46191-99bed56de5a5ed7f.js");
"use strict";(globalThis.webpackChunk_github_ui_github_ui=globalThis.webpackChunk_github_ui_github_ui||[]).push([["46191"],{27190(e,t,r){let n;r.d(t,{H:()=>$});var s=r(35750),a=r(18150),i=r(85242),o=r(88243),u=r(16213),l=r(10204),c=new WeakMap,h=new WeakSet;class d extends l.ib{constructor(e,t,r,n,s){super(e,()=>(0,o._)(this,h,b).call(this),r,n,void 0,s),(0,u._)(this,h),(0,a._)(this,c,{writable:!0,value:void 0}),(0,i._)(this,c,t)}}function b(){return f((0,s._)(this,c))}async function f(e){let t=await w(e);return t&&t.url&&t.token?p(t.url,t.token):null}async function w(e){let t=await fetch(e,{headers:{Accept:"application/json"}});if(t.ok)return t.json();if(404===t.status)return null;throw Error("fetch error")}async function p(e,t){let r=await fetch(e,{method:"POST",mode:"same-origin",headers:{"Scoped-CSRF-Token":t}});if(r.ok)return r.text();throw Error("fetch error")}var _=r(70170),m=r(77563),k=r(69991),g=r(23683);function v(e,{channel:t,type:r,data:n}){for(let s of e)s.dispatchEvent(new CustomEvent(`socket:${r}`,{bubbles:!1,cancelable:!1,detail:{name:t,data:n}}))}var M=new WeakMap,y=new WeakMap,S=new WeakMap,E=new WeakMap,A=new WeakMap,W=new WeakSet;class P{subscribe(e){let t=(0,s._)(this,y).add(...e);t.length&&(0,s._)(this,M).port.postMessage({subscribe:t});let r=new Set(t.map(e=>e.name)),n=e.reduce((e,t)=>{let n=t.topic.name;return(0,l.JR)(n)&&!r.has(n)&&e.add(n),e},new Set);n.size&&(0,s._)(this,M).port.postMessage({requestPresence:Array.from(n)})}unsubscribeAll(...e){let t=(0,s._)(this,y).drain(...e);t.length&&(0,s._)(this,M).port.postMessage({unsubscribe:t});let r=(0,s._)(this,S).removeSubscribers(e);this.sendPresenceMetadataUpdate(r)}updatePresenceMetadata(e){let t=new Set;for(let r of e)(0,s._)(this,S).setMetadata(r),t.add(r.channelName);this.sendPresenceMetadataUpdate(t)}sendPresenceMetadataUpdate(e){if(!e.size)return;let t=[];for(let r of e)t.push({channelName:r,metadata:(0,s._)(this,S).getChannelMetadata(r)});(0,s._)(this,M).port.postMessage({updatePresenceMetadata:t})}online(){(0,s._)(this,M).port.postMessage({online:!0})}offline(){(0,s._)(this,M).port.postMessage({online:!1})}hangup(){(0,s._)(this,M).port.postMessage({hangup:!0})}constructor(e,t,r,n,c,h){(0,u._)(this,W),(0,a._)(this,M,{writable:!0,value:void 0}),(0,a._)(this,y,{writable:!0,value:new l.m0}),(0,a._)(this,S,{writable:!0,value:new l.VH}),(0,a._)(this,E,{writable:!0,value:void 0}),(0,a._)(this,A,{writable:!0,value:new Map}),(0,i._)(this,E,c),(0,i._)(this,M,new SharedWorker(`${e}?module=true`,{name:`github-socket-worker-v3-${n}`,type:"module"})),(0,s._)(this,M).port.onmessage=({data:e})=>(0,o._)(this,W,C).call(this,e),(0,s._)(this,M).port.postMessage({connect:{url:t,refreshUrl:r,options:h}})}}function C(e){let{channel:t}=e;if("presence"===e.type){let r=(0,s._)(this,A).get(t);r||(r=(0,_.s)((e,r)=>{(0,s._)(this,E).call(this,e,r),(0,s._)(this,A).delete(t)},100),(0,s._)(this,A).set(t,r)),r((0,s._)(this,y).subscribers(t),e);return}(0,s._)(this,E).call(this,(0,s._)(this,y).subscribers(t),e)}async function q(){let e,t=(e=document.head.querySelector("link[rel=shared-web-socket-src]")?.getAttribute("href"))&&e.startsWith("/")?e:null;if(!t)return;let r=document.head.querySelector("link[rel=shared-web-socket]")?.href??null;if(!r)return;let n=document.head.querySelector("link[rel=shared-web-socket]")?.getAttribute("data-refresh-url")??null;if(!n)return;let s=document.head.querySelector("link[rel=shared-web-socket]")?.getAttribute("data-session-id")??null;if(!s)return;let a=(()=>{let e={};if(!(0,g.isSafari)()&&"SharedWorker"in window&&"true"!==(0,k.A)("localStorage").getItem("bypassSharedWorker"))try{return new P(t,r,n,s,v,e)}catch{}return new d(r,n,!1,v,e)})();return window.addEventListener("online",()=>a.online()),window.addEventListener("offline",()=>a.offline()),window.addEventListener("pagehide",()=>{"hangup"in a&&a.hangup()}),a}async function T(){return await m.G,q()}function $(){return n||(n=T())}},24892(e,t,r){r.d(t,{$:()=>i});var n=r(10204),s=r(23075);let a=new WeakMap;function i(e,t,r){let i;if(!e)throw Error("Not connected to alive");if(!t)throw Error("No channel name");let o=n.KK.parse(t);if(!o)throw Error("Invalid channel name");let u={subscriber:{dispatchEvent:e=>{e instanceof CustomEvent&&r(e.detail.data)}},topic:o},l=((i=a.get(e))||(i={subscribe:(0,s.rK)(t=>e.subscribe(t.flat())),unsubscribeAll:(0,s.rK)(t=>e.unsubscribeAll(...t))},a.set(e,i)),i);return l.subscribe([u]),{unsubscribe:()=>l.unsubscribeAll(u.subscriber)}}},23075(e,t,r){function n(){return Promise.resolve()}function s(){return new Promise(window.requestAnimationFrame)}async function a(e,t){let r,n=new Promise(t=>{r=self.setTimeout(t,e)});if(!t)return n;try{var s;await Promise.race([n,(s=t,new Promise((e,t)=>{let r=Error("aborted");r.name="AbortError",s.aborted?t(r):s.addEventListener("abort",()=>t(r))}))])}catch(e){throw self.clearTimeout(r),e}}function i(e){let t=[];return function(r){t.push(r),1===t.length&&queueMicrotask(()=>{let r=t.slice(0);t.length=0,e(r)})}}r.d(t,{G$:()=>s,k2:()=>n,rK:()=>i,uk:()=>a})},9234(e,t,r){r.d(t,{x:()=>l});var n=r(96540),s=r(1827),a=r(27190),i=r(24892),o=(r(74848),r(16522),r(10204));let u=(0,n.createContext)(null);u.displayName="AliveTestContext";function l(e,t){let r=(0,s.A)(),o=(0,n.use)(u);(0,n.useEffect)(()=>{let n=()=>{},s=!1;return async function(){if(e){if("function"==typeof o){let r=await o(e,t);r&&(n=r.unsubscribe);return}try{let o=await (0,a.H)();if(s)return;let u=(0,i.$)(o,e,t);u?.unsubscribe&&(r()?n=u.unsubscribe:u.unsubscribe())}catch(e){console.error(e)}}}(),()=>{s=!0,n()}},[e,t,r,o])}},1827(e,t,r){r.d(t,{A:()=>a});var n=r(16522),s=r(96540);function a(){let e,t,r,a=(0,n.c)(3),i=(0,s.useRef)(!1);a[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>i.current,a[0]=e):e=a[0];let o=e;return a[1]===Symbol.for("react.memo_cache_sentinel")?(t=()=>(i.current=!0,()=>{i.current=!1}),r=[],a[1]=t,a[2]=r):(t=a[1],r=a[2]),(0,s.useLayoutEffect)(t,r),o}}}]);
//# sourceMappingURL=46191-99bed56de5a5ed7f-e07d6b4cee768662.js.map